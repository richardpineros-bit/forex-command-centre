//@version=6
indicator("Advanced Forex EMA Trend Tool - MTF & Price Action", overlay=true, max_labels_count=500, max_lines_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘                   ADVANCED FOREX EMA TREND TOOL v1.0                         â•‘
// â•‘              Multi-Timeframe Analysis & Price Action System                  â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// ğŸ“Š OVERVIEW:
// This professional-grade indicator combines EMA trend analysis with multi-timeframe
// confirmation, advanced filters, and price action detection for high-probability
// forex trading setups.
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ KEY FEATURES:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// 1. EMA SYSTEM (4 Moving Averages)
//    â€¢ Fast EMA (9) - Short-term momentum
//    â€¢ Medium EMA (21) - Primary signal line
//    â€¢ Slow EMA (50) - Trend confirmation
//    â€¢ HTF Trend EMA (200) - Major trend filter
//    â€¢ Ribbon visualization between Fast and Slow EMAs
//
// 2. MULTI-TIMEFRAME ANALYSIS
//    â€¢ Track trend alignment across 3 timeframes simultaneously
//    â€¢ Separate MTF table shows each timeframe's direction
//    â€¢ Full alignment alerts when all timeframes agree
//    â€¢ Contributes to overall trend strength score
//
// 3. ADVANCED FILTERS
//    â€¢ HTF Trend Filter - Only trade with higher timeframe direction
//    â€¢ ADX Filter - Avoid choppy, ranging markets (default: 20)
//    â€¢ ATR Volatility Filter - Only trade during active market conditions
//    â€¢ Session Filter - Optional trading window restrictions
//
// 4. PRICE ACTION FEATURES
//    â€¢ Swing High/Low Detection - Automatic support/resistance levels
//    â€¢ EMA Touch Detection - Identifies pullbacks to key EMAs
//    â€¢ Pin Bar Detection - Spots reversal patterns at EMA levels
//
// 5. SIGNAL TYPES
//    â€¢ Crossover Signals - Fast/Medium EMA crosses (filtered)
//    â€¢ Pullback Signals - Price retest of EMAs in trending markets
//    â€¢ Pin Bar Signals - Reversal candles at key levels
//
// 6. TREND STRENGTH SCORE (0-100)
//    Composite scoring system based on:
//    â€¢ EMA alignment (40 points)
//    â€¢ HTF trend direction (20 points)
//    â€¢ ADX momentum (20 points)
//    â€¢ MTF alignment (20 points)
//    â–º Trade only when score â‰¥ 80 for highest probability setups
//
// 7. PROFESSIONAL DASHBOARDS
//    â€¢ Main Dashboard - All key metrics in one place
//    â€¢ MTF Table - Separate timeframe alignment display
//    â€¢ Fully customizable colors, sizes, and positions
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“– HOW TO USE:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// RECOMMENDED SETTINGS BY TRADING STYLE:
//
// ğŸ”¹ SCALPING (M5-M15 charts)
//    â€¢ MTF Timeframes: 15 / 60 / 240
//    â€¢ HTF Trend Filter: H4
//    â€¢ ADX Threshold: 20
//    â€¢ Focus on: Pullback signals + Pin bars
//
// ğŸ”¹ DAY TRADING (H1-H4 charts)
//    â€¢ MTF Timeframes: 60 / 240 / D
//    â€¢ HTF Trend Filter: Daily
//    â€¢ ADX Threshold: 20
//    â€¢ Focus on: All signal types
//
// ğŸ”¹ SWING TRADING (H4-Daily charts)
//    â€¢ MTF Timeframes: 240 / D / W
//    â€¢ HTF Trend Filter: Weekly
//    â€¢ ADX Threshold: 25
//    â€¢ Focus on: Crossover signals
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ TRADING STRATEGY GUIDE:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// HIGH PROBABILITY SETUP CHECKLIST:
// âœ“ Trend Strength Score â‰¥ 80
// âœ“ All 3 MTF timeframes aligned (Full Bull/Bear)
// âœ“ ADX > threshold (Trending, not Choppy)
// âœ“ ATR Filter active (sufficient volatility)
// âœ“ Price above/below HTF Trend EMA with correct slope
// âœ“ Session filter active (if enabled)
//
// ENTRY STRATEGIES:
//
// 1. AGGRESSIVE (Crossover Entry)
//    â€¢ Wait for Fast EMA to cross Medium EMA
//    â€¢ All filters must be green
//    â€¢ Enter on crossover signal
//    â€¢ Stop: Below/above recent swing level
//
// 2. CONSERVATIVE (Pullback Entry)
//    â€¢ Wait for crossover to establish trend
//    â€¢ Wait for price to pull back to Medium EMA
//    â€¢ Enter on "PB" signal when price touches EMA
//    â€¢ Stop: Below/above the pullback candle
//
// 3. CONFIRMATION (Pin Bar Entry)
//    â€¢ Wait for established trend
//    â€¢ Look for pin bar diamond signals at EMAs
//    â€¢ Enter on next candle after pin bar
//    â€¢ Stop: Beyond pin bar wick
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš™ï¸ CUSTOMIZATION GUIDE:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// EMA SETTINGS:
// â€¢ Adjust lengths for different market speeds
// â€¢ Faster = more signals (more noise)
// â€¢ Slower = fewer signals (more reliable)
//
// VISUAL CUSTOMIZATION:
// â€¢ Each EMA has individual color and width controls
// â€¢ Ribbon fill shows trend direction visually
// â€¢ Background color provides HTF trend context
// â€¢ All signals have customizable colors
//
// FILTER TUNING:
// â€¢ ADX Threshold: Lower = more signals, Higher = stronger trends only
// â€¢ ATR Multiplier: Higher = only high volatility periods
// â€¢ EMA Touch Tolerance: Adjust for different pip values
//
// DASHBOARD LAYOUT:
// â€¢ Main Dashboard: Shows all metrics and filters
// â€¢ MTF Table: Independent position control
// â€¢ Choose "Auto" for smart positioning or manual placement
// â€¢ Both tables share color scheme for consistency
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸš¨ ALERT TYPES:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// Available alerts (set in TradingView alert panel):
// â€¢ ğŸŸ¢ Buy Cross Alert - Bullish crossover with all filters aligned
// â€¢ ğŸ”´ Sell Cross Alert - Bearish crossover with all filters aligned
// â€¢ ğŸ”µ Buy Pullback Alert - Bullish pullback to EMA
// â€¢ ğŸŸ  Sell Pullback Alert - Bearish pullback to EMA
// â€¢ ğŸ’ Pin Bar Alerts - Reversal patterns at EMAs
// â€¢ â­ Full MTF Alignment - All timeframes agree
// â€¢ ğŸš€ Strong Trend Alerts - Trend score reaches 80+
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š DASHBOARD INTERPRETATION:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// MAIN DASHBOARD METRICS:
// â€¢ EMA Trend: Current chart timeframe trend direction
// â€¢ HTF Trend: Higher timeframe trend with slope (Up/Down/Flat)
// â€¢ ADX: Momentum reading (Trending vs Choppy)
// â€¢ ATR Filter: Volatility status (Active vs Low)
// â€¢ Trend Score: Overall setup quality (0-100)
// â€¢ Dist to Slow EMA: Current price distance from trend
// â€¢ Session: Trading window status (if filter enabled)
//
// MTF TABLE:
// â€¢ Shows trend direction for each selected timeframe
// â€¢ Green = Bullish, Red = Bearish
// â€¢ Look for all three aligned for strongest setups
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ RISK MANAGEMENT TIPS:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// 1. NEVER trade without confirming trend score â‰¥ 80
// 2. Use swing levels (horizontal lines) for stop placement
// 3. Avoid trading during major news events
// 4. Risk 1-2% of account per trade maximum
// 5. Take partial profits at key swing levels
// 6. Trail stop to breakeven after 1:1 risk/reward
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ NOTES:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// â€¢ Best results on major forex pairs (EUR/USD, GBP/USD, USD/JPY)
// â€¢ Works on any timeframe but designed for H1 and above
// â€¢ Combine with proper risk management for consistent results
// â€¢ Backtest settings on your preferred pairs before live trading
// â€¢ This indicator provides signals - YOU make the trading decisions
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‘¨â€ğŸ’» DEVELOPER: Custom Forex Trading Tool
// ğŸ“… VERSION: 1.0
// ğŸ”„ LAST UPDATED: 2025
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 1: EMA SETTINGS ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fastLength = input.int(9, "Fast EMA Length", minval=1, group="EMA Settings")
midLength = input.int(21, "Medium EMA Length", minval=1, group="EMA Settings")
slowLength = input.int(50, "Slow EMA Length", minval=1, group="EMA Settings")
htfLength = input.int(200, "HTF Trend EMA Length", minval=1, group="EMA Settings")

emaTF = input.timeframe("", "EMA Timeframe (empty = current)", group="EMA Settings")
htfTF = input.timeframe("240", "HTF Trend Filter Timeframe", group="EMA Settings")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 2: EMA VISUAL CUSTOMIZATION ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
showFastEMA = input.bool(true, "Show Fast EMA", group="EMA Display", inline="fast")
fastColor = input.color(color.new(#00bcd4, 0), "", group="EMA Display", inline="fast")
fastWidth = input.int(2, "", minval=1, maxval=5, group="EMA Display", inline="fast")

showMidEMA = input.bool(true, "Show Medium EMA", group="EMA Display", inline="mid")
midColor = input.color(color.new(#ff9800, 0), "", group="EMA Display", inline="mid")
midWidth = input.int(2, "", minval=1, maxval=5, group="EMA Display", inline="mid")

showSlowEMA = input.bool(true, "Show Slow EMA", group="EMA Display", inline="slow")
slowColor = input.color(color.new(#9c27b0, 0), "", group="EMA Display", inline="slow")
slowWidth = input.int(2, "", minval=1, maxval=5, group="EMA Display", inline="slow")

showTrendEMA = input.bool(true, "Show HTF Trend EMA", group="EMA Display", inline="trend")
trendColor = input.color(color.new(#ffeb3b, 0), "", group="EMA Display", inline="trend")
trendWidth = input.int(3, "", minval=1, maxval=5, group="EMA Display", inline="trend")

// Ribbon Fill Customization
showRibbon = input.bool(true, "Show EMA Ribbon Fill", group="EMA Display", inline="rib1")
ribbonBullColor = input.color(color.new(#4caf50, 85), "Bull", group="EMA Display", inline="rib1")
ribbonBearColor = input.color(color.new(#f44336, 85), "Bear", group="EMA Display", inline="rib1")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 3: FILTERS & CONFIRMATIONS ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
useHTFFilter = input.bool(true, "Use HTF Trend Filter", group="Filters")
useADX = input.bool(true, "Use ADX Filter", group="Filters")
adxLength = input.int(14, "ADX Length", minval=1, group="Filters")
adxSmoothing = input.int(14, "ADX Smoothing", minval=1, group="Filters")
adxThreshold = input.float(20.0, "ADX Threshold", minval=1.0, group="Filters")

useATRFilter = input.bool(true, "Use ATR Volatility Filter", group="Filters")
atrLength = input.int(14, "ATR Length", minval=1, group="Filters")
atrMultiplier = input.float(1.2, "ATR Multiplier (vs MA)", minval=0.5, step=0.1, group="Filters")

useSessionFilter = input.bool(false, "Trade Only Major Sessions", group="Filters")
sessionStart = input.string("0300-0000", "Session Time (24h format)", group="Filters", tooltip="Format: HHMM-HHMM:Days (e.g., 0300-1700:23456 for Mon-Fri 3am-5pm ET)")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 4: MULTI-TIMEFRAME ANALYSIS ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
useMTF = input.bool(true, "Enable MTF Alignment Analysis", group="Multi-Timeframe")
mtf1 = input.timeframe("15", "MTF 1 (Lower)", group="Multi-Timeframe")
mtf2 = input.timeframe("60", "MTF 2 (Middle)", group="Multi-Timeframe")
mtf3 = input.timeframe("240", "MTF 3 (Higher)", group="Multi-Timeframe")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 5: PRICE ACTION FEATURES ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
showSwingLevels = input.bool(true, "Show Swing High/Low Levels", group="Price Action")
swingLength = input.int(10, "Swing Detection Length", minval=3, group="Price Action")
swingLineColor = input.color(color.new(#2196f3, 50), "Swing Level Color", group="Price Action")
swingLineWidth = input.int(1, "Swing Line Width", minval=1, maxval=3, group="Price Action")
swingLineStyle = input.string("Dashed", "Swing Line Style", options=["Solid", "Dashed", "Dotted"], group="Price Action")

detectEMATouch = input.bool(true, "Detect EMA Touch/Pullback", group="Price Action")
emaTouchTolerance = input.float(0.1, "EMA Touch Tolerance %", minval=0.01, step=0.01, group="Price Action")

detectPinBars = input.bool(true, "Detect Pin Bars at EMAs", group="Price Action")
pinBarRatio = input.float(2.0, "Pin Bar Wick/Body Ratio", minval=1.5, step=0.1, group="Price Action")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 6: SIGNALS & ALERTS ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
showCrossSignals = input.bool(true, "Show Crossover Signals", group="Signals")
showPullbackSignals = input.bool(true, "Show Pullback Signals", group="Signals")

signalBuyColor = input.color(color.new(#00e676, 0), "Buy Signal Color", group="Signals", inline="sig1")
signalSellColor = input.color(color.new(#ff1744, 0), "Sell Signal Color", group="Signals", inline="sig1")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 7: BACKGROUND & VISUAL AIDS ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
showBG = input.bool(true, "Show Trend Background", group="Visual Aids")
bgBullColor = input.color(color.new(#4caf50, 92), "Bullish BG", group="Visual Aids", inline="bg1")
bgBearColor = input.color(color.new(#f44336, 92), "Bearish BG", group="Visual Aids", inline="bg1")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SECTION 8: DASHBOARD CUSTOMIZATION ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
showDashboard = input.bool(true, "Show Dashboard", group="Dashboard")
dashPosition = input.string("Top Right", "Position", options=["Top Left", "Top Right", "Bottom Left", "Bottom Right", "Middle Right"], group="Dashboard")
dashSize = input.string("Normal", "Text Size", options=["Tiny", "Small", "Normal", "Large", "Huge"], group="Dashboard")
dashBGColor = input.color(color.new(#263238, 15), "Background Color", group="Dashboard")
dashTextColor = input.color(color.new(#ffffff, 0), "Text Color", group="Dashboard")
dashBorderColor = input.color(color.new(#00bcd4, 0), "Border Color", group="Dashboard")

showMTFTable = input.bool(true, "Show MTF Alignment Table", group="Dashboard")
mtfTablePosition = input.string("Auto (Opposite Side)", "MTF Table Position", options=["Auto (Opposite Side)", "Top Left", "Top Right", "Bottom Left", "Bottom Right", "Middle Left", "Middle Right"], group="Dashboard")
showTrendScore = input.bool(true, "Show Trend Strength Score", group="Dashboard")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: EMAs ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fastEMA = request.security(syminfo.tickerid, emaTF, ta.ema(close, fastLength), gaps=barmerge.gaps_off)
midEMA = request.security(syminfo.tickerid, emaTF, ta.ema(close, midLength), gaps=barmerge.gaps_off)
slowEMA = request.security(syminfo.tickerid, emaTF, ta.ema(close, slowLength), gaps=barmerge.gaps_off)
trendEMA = request.security(syminfo.tickerid, htfTF, ta.ema(close, htfLength), gaps=barmerge.gaps_off)

trendSlopeUp = trendEMA > trendEMA[1]
trendSlopeDown = trendEMA < trendEMA[1]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: ADX ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
upMove = high - high[1]
downMove = low[1] - low
plusDM = (upMove > downMove and upMove > 0) ? upMove : 0.0
minusDM = (downMove > upMove and downMove > 0) ? downMove : 0.0
trueRange = math.max(high - low, math.max(math.abs(high - close[1]), math.abs(low - close[1])))

plusDM_rma = ta.rma(plusDM, adxLength)
minusDM_rma = ta.rma(minusDM, adxLength)
tr_rma = ta.rma(trueRange, adxLength)

plusDI = tr_rma > 0 ? 100.0 * (plusDM_rma / tr_rma) : 0.0
minusDI = tr_rma > 0 ? 100.0 * (minusDM_rma / tr_rma) : 0.0
dx = (plusDI + minusDI > 0) ? 100.0 * (math.abs(plusDI - minusDI) / (plusDI + minusDI)) : 0.0
adxValue = ta.rma(dx, adxSmoothing)
adxFilter = not useADX or adxValue > adxThreshold

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: ATR Filter ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
atrValue = ta.atr(atrLength)
atrMA = ta.sma(atrValue, 50)
atrFilter = not useATRFilter or atrValue > (atrMA * atrMultiplier)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: Session Filter ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
sessionTime = time(timeframe.period, sessionStart)
inSession = not useSessionFilter or not na(sessionTime)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: Multi-Timeframe Alignment ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
mtf1Bullish = request.security(syminfo.tickerid, mtf1, ta.ema(close, fastLength) > ta.ema(close, slowLength), gaps=barmerge.gaps_off)
mtf2Bullish = request.security(syminfo.tickerid, mtf2, ta.ema(close, fastLength) > ta.ema(close, slowLength), gaps=barmerge.gaps_off)
mtf3Bullish = request.security(syminfo.tickerid, mtf3, ta.ema(close, fastLength) > ta.ema(close, slowLength), gaps=barmerge.gaps_off)

mtfBullCount = (mtf1Bullish ? 1 : 0) + (mtf2Bullish ? 1 : 0) + (mtf3Bullish ? 1 : 0)
mtfBearCount = (not mtf1Bullish ? 1 : 0) + (not mtf2Bullish ? 1 : 0) + (not mtf3Bullish ? 1 : 0)
mtfFullAlignment = mtfBullCount == 3 or mtfBearCount == 3
mtfAlignmentBullish = mtfBullCount == 3

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: Trend Strength Score ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
trendScore = 0.0
trendScore += (fastEMA > midEMA ? 20 : 0)
trendScore += (midEMA > slowEMA ? 20 : 0)
trendScore += (close > trendEMA and trendSlopeUp ? 20 : 0)
trendScore += (adxValue > adxThreshold ? 20 : 0)
trendScore += (mtfFullAlignment and mtfAlignmentBullish ? 20 : 0)

// Bearish score
trendScoreBear = 0.0
trendScoreBear += (fastEMA < midEMA ? 20 : 0)
trendScoreBear += (midEMA < slowEMA ? 20 : 0)
trendScoreBear += (close < trendEMA and trendSlopeDown ? 20 : 0)
trendScoreBear += (adxValue > adxThreshold ? 20 : 0)
trendScoreBear += (mtfFullAlignment and not mtfAlignmentBullish ? 20 : 0)

finalTrendScore = math.max(trendScore, trendScoreBear)
strongTrend = finalTrendScore >= 80

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: Price Action - Swing Levels ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
swingHigh = ta.pivothigh(high, swingLength, swingLength)
swingLow = ta.pivotlow(low, swingLength, swingLength)

var float lastSwingHigh = na
var float lastSwingLow = na
var int swingHighBar = na
var int swingLowBar = na

if not na(swingHigh)
    lastSwingHigh := swingHigh
    swingHighBar := bar_index - swingLength

if not na(swingLow)
    lastSwingLow := swingLow
    swingLowBar := bar_index - swingLength

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: EMA Touch Detection ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
touchingMid = math.abs(close - midEMA) / close * 100 < emaTouchTolerance
touchingSlow = math.abs(close - slowEMA) / close * 100 < emaTouchTolerance

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === CALCULATIONS: Pin Bar Detection ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
bodySize = math.abs(close - open)
candleRange = high - low
upperWick = high - math.max(close, open)
lowerWick = math.min(close, open) - low

bullPin = lowerWick > bodySize * pinBarRatio and upperWick < bodySize and close > open and bodySize > 0
bearPin = upperWick > bodySize * pinBarRatio and lowerWick < bodySize and close < open and bodySize > 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === SIGNAL LOGIC ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Crossover Signals
bullCross = ta.crossover(fastEMA, midEMA)
bearCross = ta.crossunder(fastEMA, midEMA)

htfConditionBull = not useHTFFilter or (close > trendEMA and trendSlopeUp)
htfConditionBear = not useHTFFilter or (close < trendEMA and trendSlopeDown)

longCrossSignal = bullCross and htfConditionBull and adxFilter and atrFilter and inSession
shortCrossSignal = bearCross and htfConditionBear and adxFilter and atrFilter and inSession

// Pullback Signals
pullbackBuySignal = touchingMid and close > midEMA and fastEMA > slowEMA and htfConditionBull and adxFilter and atrFilter and inSession
pullbackSellSignal = touchingMid and close < midEMA and fastEMA < slowEMA and htfConditionBear and adxFilter and atrFilter and inSession

// Pin Bar Signals at EMAs
pinBuySignal = bullPin and (touchingMid or touchingSlow) and fastEMA > slowEMA and htfConditionBull and detectPinBars
pinSellSignal = bearPin and (touchingMid or touchingSlow) and fastEMA < slowEMA and htfConditionBear and detectPinBars

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === PLOTTING: EMAs ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
plot(showFastEMA ? fastEMA : na, color=fastColor, linewidth=fastWidth, title="Fast EMA")
plot(showMidEMA ? midEMA : na, color=midColor, linewidth=midWidth, title="Medium EMA")
plot(showSlowEMA ? slowEMA : na, color=slowColor, linewidth=slowWidth, title="Slow EMA")
plot(showTrendEMA ? trendEMA : na, color=trendColor, linewidth=trendWidth, title="HTF Trend EMA")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === PLOTTING: Ribbon Fill ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ribbonBull = fastEMA > slowEMA
ribbonColorFill = ribbonBull ? ribbonBullColor : ribbonBearColor
p1 = plot(showRibbon ? fastEMA : na, display=display.none, title="Ribbon Top")
p2 = plot(showRibbon ? slowEMA : na, display=display.none, title="Ribbon Bottom")
fill(p1, p2, color=ribbonColorFill, title="EMA Ribbon")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === PLOTTING: Swing Levels ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
lineStyleConvert = swingLineStyle == "Solid" ? line.style_solid : swingLineStyle == "Dashed" ? line.style_dashed : line.style_dotted

var line swingHighLine = na
var line swingLowLine = na

if showSwingLevels and not na(lastSwingHigh)
    line.delete(swingHighLine)
    swingHighLine := line.new(bar_index - 50, lastSwingHigh, bar_index + 10, lastSwingHigh, 
                              color=swingLineColor, width=swingLineWidth, style=lineStyleConvert, extend=extend.right)

if showSwingLevels and not na(lastSwingLow)
    line.delete(swingLowLine)
    swingLowLine := line.new(bar_index - 50, lastSwingLow, bar_index + 10, lastSwingLow, 
                             color=swingLineColor, width=swingLineWidth, style=lineStyleConvert, extend=extend.right)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === PLOTTING: Signals ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
plotshape(showCrossSignals and longCrossSignal, title="Buy Cross Signal", location=location.belowbar,
          color=signalBuyColor, style=shape.triangleup, size=size.small, text="BUY")
plotshape(showCrossSignals and shortCrossSignal, title="Sell Cross Signal", location=location.abovebar,
          color=signalSellColor, style=shape.triangledown, size=size.small, text="SELL")

plotshape(showPullbackSignals and detectEMATouch and pullbackBuySignal, title="Buy Pullback", location=location.belowbar,
          color=signalBuyColor, style=shape.circle, size=size.tiny, text="PB")
plotshape(showPullbackSignals and detectEMATouch and pullbackSellSignal, title="Sell Pullback", location=location.abovebar,
          color=signalSellColor, style=shape.circle, size=size.tiny, text="PB")

plotshape(pinBuySignal, title="Pin Bar Buy", location=location.belowbar,
          color=color.new(color.lime, 0), style=shape.diamond, size=size.tiny)
plotshape(pinSellSignal, title="Pin Bar Sell", location=location.abovebar,
          color=color.new(color.orange, 0), style=shape.diamond, size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === PLOTTING: Background ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
bgColor = showBG ? (trendSlopeUp ? bgBullColor : trendSlopeDown ? bgBearColor : na) : na
bgcolor(bgColor, title="Trend Background")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === DASHBOARD ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if showDashboard and barstate.islast
    // Position
    dashPos = dashPosition == "Top Left" ? position.top_left : 
              dashPosition == "Top Right" ? position.top_right :
              dashPosition == "Bottom Left" ? position.bottom_left :
              dashPosition == "Bottom Right" ? position.bottom_right : position.middle_right
    
    // Size
    actualDashSize = dashSize == "Tiny" ? size.tiny : dashSize == "Small" ? size.small :
                     dashSize == "Normal" ? size.normal : dashSize == "Large" ? size.large : size.huge
    
    // Main Dashboard Table
    var table mainTable = table.new(dashPos, 2, 8, border_width=2, border_color=dashBorderColor, bgcolor=dashBGColor)
    
    // Header
    table.cell(mainTable, 0, 0, "METRIC", text_color=dashTextColor, bgcolor=color.new(dashBorderColor, 70), text_size=actualDashSize)
    table.cell(mainTable, 1, 0, "VALUE", text_color=dashTextColor, bgcolor=color.new(dashBorderColor, 70), text_size=actualDashSize)
    
    // EMA Trend
    emaTrend = fastEMA > slowEMA ? "BULLISH â–²" : "BEARISH â–¼"
    emaTrendColor = fastEMA > slowEMA ? color.green : color.red
    table.cell(mainTable, 0, 1, "EMA Trend", text_color=dashTextColor, text_size=actualDashSize)
    table.cell(mainTable, 1, 1, emaTrend, text_color=emaTrendColor, text_size=actualDashSize)
    
    // HTF Trend
    htfTrend = close > trendEMA ? (trendSlopeUp ? "BULL UP â¬†" : "BULL FLAT â†’") : 
               (trendSlopeDown ? "BEAR DOWN â¬‡" : "BEAR FLAT â†’")
    htfColor = close > trendEMA and trendSlopeUp ? color.green : 
               close < trendEMA and trendSlopeDown ? color.red : color.gray
    table.cell(mainTable, 0, 2, "HTF (" + htfTF + ")", text_color=dashTextColor, text_size=actualDashSize)
    table.cell(mainTable, 1, 2, htfTrend, text_color=htfColor, text_size=actualDashSize)
    
    // ADX
    adxStatus = adxValue > adxThreshold ? "TRENDING âœ“" : "CHOPPY âœ—"
    adxColor = adxValue > adxThreshold ? color.green : color.orange
    table.cell(mainTable, 0, 3, "ADX", text_color=dashTextColor, text_size=actualDashSize)
    table.cell(mainTable, 1, 3, str.tostring(adxValue, "#.#") + " " + adxStatus, text_color=adxColor, text_size=actualDashSize)
    
    // ATR Filter
    if useATRFilter
        atrStatus = atrValue > (atrMA * atrMultiplier) ? "ACTIVE âœ“" : "LOW âœ—"
        atrColor = atrValue > (atrMA * atrMultiplier) ? color.green : color.orange
        table.cell(mainTable, 0, 4, "ATR Filter", text_color=dashTextColor, text_size=actualDashSize)
        table.cell(mainTable, 1, 4, atrStatus, text_color=atrColor, text_size=actualDashSize)
    
    // Trend Strength Score
    if showTrendScore
        scoreText = str.tostring(finalTrendScore, "#") + "/100"
        scoreColor = finalTrendScore >= 80 ? color.green : finalTrendScore >= 60 ? color.yellow : 
                     finalTrendScore >= 40 ? color.orange : color.red
        table.cell(mainTable, 0, 5, "Trend Score", text_color=dashTextColor, text_size=actualDashSize)
        table.cell(mainTable, 1, 5, scoreText, text_color=scoreColor, text_size=actualDashSize)
    
    // Distance to Slow EMA
    distToSlow = (close - slowEMA) / slowEMA * 100
    distText = str.tostring(distToSlow, "#.##") + "%"
    distColor = distToSlow > 0 ? color.green : color.red
    table.cell(mainTable, 0, 6, "Dist to Slow EMA", text_color=dashTextColor, text_size=actualDashSize)
    table.cell(mainTable, 1, 6, distText, text_color=distColor, text_size=actualDashSize)
    
    // Session Status
    if useSessionFilter
        sessionStatus = inSession ? "ACTIVE âœ“" : "CLOSED âœ—"
        sessionColor = inSession ? color.green : color.red
        table.cell(mainTable, 0, 7, "Session", text_color=dashTextColor, text_size=actualDashSize)
        table.cell(mainTable, 1, 7, sessionStatus, text_color=sessionColor, text_size=actualDashSize)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === MTF ALIGNMENT TABLE ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if showMTFTable and useMTF and barstate.islast
    // Determine MTF table position
    mtfPos = position.top_left  // default
    
    if mtfTablePosition == "Auto (Opposite Side)"
        // Place on opposite side of main dashboard
        mtfPos := (dashPosition == "Top Left" or dashPosition == "Bottom Left") ? position.top_right : position.top_left
    else if mtfTablePosition == "Top Left"
        mtfPos := position.top_left
    else if mtfTablePosition == "Top Right"
        mtfPos := position.top_right
    else if mtfTablePosition == "Bottom Left"
        mtfPos := position.bottom_left
    else if mtfTablePosition == "Bottom Right"
        mtfPos := position.bottom_right
    else if mtfTablePosition == "Middle Left"
        mtfPos := position.middle_left
    else if mtfTablePosition == "Middle Right"
        mtfPos := position.middle_right
    
    actualDashSize2 = dashSize == "Tiny" ? size.tiny : dashSize == "Small" ? size.small :
                      dashSize == "Normal" ? size.normal : dashSize == "Large" ? size.large : size.huge
    
    var table mtfTable = table.new(mtfPos, 2, 4, border_width=2, border_color=dashBorderColor, bgcolor=dashBGColor)
    
    // Header
    table.cell(mtfTable, 0, 0, "TIMEFRAME", text_color=dashTextColor, bgcolor=color.new(dashBorderColor, 70), text_size=actualDashSize2)
    table.cell(mtfTable, 1, 0, "TREND", text_color=dashTextColor, bgcolor=color.new(dashBorderColor, 70), text_size=actualDashSize2)
    
    // MTF 1
    mtf1Status = mtf1Bullish ? "BULL â–²" : "BEAR â–¼"
    mtf1ColorCell = mtf1Bullish ? color.green : color.red
    table.cell(mtfTable, 0, 1, mtf1, text_color=dashTextColor, text_size=actualDashSize2)
    table.cell(mtfTable, 1, 1, mtf1Status, text_color=mtf1ColorCell, text_size=actualDashSize2)
    
    // MTF 2
    mtf2Status = mtf2Bullish ? "BULL â–²" : "BEAR â–¼"
    mtf2ColorCell = mtf2Bullish ? color.green : color.red
    table.cell(mtfTable, 0, 2, mtf2, text_color=dashTextColor, text_size=actualDashSize2)
    table.cell(mtfTable, 1, 2, mtf2Status, text_color=mtf2ColorCell, text_size=actualDashSize2)
    
    // MTF 3
    mtf3Status = mtf3Bullish ? "BULL â–²" : "BEAR â–¼"
    mtf3ColorCell = mtf3Bullish ? color.green : color.red
    table.cell(mtfTable, 0, 3, mtf3, text_color=dashTextColor, text_size=actualDashSize2)
    table.cell(mtfTable, 1, 3, mtf3Status, text_color=mtf3ColorCell, text_size=actualDashSize2)
    
    // Alignment Summary (optional 4th row)
    // mtfAlignmentText = mtfFullAlignment ? (mtfAlignmentBullish ? "ğŸŸ¢ FULL BULL" : "ğŸ”´ FULL BEAR") : "âš ï¸ MIXED"
    // table.cell(mtfTable, 0, 4, "ALIGNMENT", text_color=dashTextColor, text_size=dashSizeConvert)
    // table.cell(mtfTable, 1, 4, mtfAlignmentText, text_color=color.white, text_size=dashSizeConvert)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === ALERTS ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
alertcondition(longCrossSignal, title="ğŸŸ¢ Buy Cross Alert", message="{{ticker}} - EMA Bullish Crossover | Price: {{close}} | HTF: Aligned | ADX: {{plot_0}}")
alertcondition(shortCrossSignal, title="ğŸ”´ Sell Cross Alert", message="{{ticker}} - EMA Bearish Crossover | Price: {{close}} | HTF: Aligned | ADX: {{plot_0}}")
alertcondition(pullbackBuySignal and detectEMATouch, title="ğŸ”µ Buy Pullback Alert", message="{{ticker}} - Bullish Pullback to EMA | Price: {{close}}")
alertcondition(pullbackSellSignal and detectEMATouch, title="ğŸŸ  Sell Pullback Alert", message="{{ticker}} - Bearish Pullback to EMA | Price: {{close}}")
alertcondition(pinBuySignal, title="ğŸ’ Pin Bar Buy Alert", message="{{ticker}} - Bullish Pin Bar at EMA | Price: {{close}}")
alertcondition(pinSellSignal, title="ğŸ’ Pin Bar Sell Alert", message="{{ticker}} - Bearish Pin Bar at EMA | Price: {{close}}")
alertcondition(mtfFullAlignment and mtfAlignmentBullish, title="â­ Full MTF Bull Alignment", message="{{ticker}} - All timeframes aligned BULLISH")
alertcondition(mtfFullAlignment and not mtfAlignmentBullish, title="â­ Full MTF Bear Alignment", message="{{ticker}} - All timeframes aligned BEARISH")
alertcondition(strongTrend and trendScore >= 80, title="ğŸš€ Strong Bullish Trend", message="{{ticker}} - Strong Bullish Trend Detected | Score: 80+")
alertcondition(strongTrend and trendScoreBear >= 80, title="ğŸš€ Strong Bearish Trend", message="{{ticker}} - Strong Bearish Trend Detected | Score: 80+")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// === PERFECT SETUP COMBINED ALERT (ALL CONDITIONS) ===
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Get RSI values from H1, H4, Daily (non-repainting)
rsiH1 = request.security(syminfo.tickerid, "60", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)
rsiH4 = request.security(syminfo.tickerid, "240", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)
rsiDaily = request.security(syminfo.tickerid, "D", ta.rsi(close, 14), lookahead=barmerge.lookahead_off)

// Check if all RSI timeframes aligned
rsiAllBullish = (rsiH1 > 50) and (rsiH4 > 50) and (rsiDaily > 50)
rsiAllBearish = (rsiH1 < 50) and (rsiH4 < 50) and (rsiDaily < 50)

// 2. Get ATR values to determine state (RELAXED VERSION)
atrCurrent = ta.atr(14)
atrH4_check = request.security(syminfo.tickerid, "240", ta.atr(14), lookahead=barmerge.lookahead_off)

// SIMPLIFIED: ATR ratio between 50%-150% = TREND
atrRatio = atrCurrent / atrH4_check
isTrendState = atrRatio > 0.5 and atrRatio < 1.5

// 3. PERFECT SETUP = All 3 conditions met
perfectBullSetup = trendScore >= 80 and rsiAllBullish and isTrendState
perfectBearSetup = trendScoreBear >= 80 and rsiAllBearish and isTrendState

// 4. Create alerts with simple messages
alertcondition(perfectBullSetup, title="â­ PERFECT BULLISH SETUP - ALL CONDITIONS MET", message="{{ticker}} PERFECT BULL: Score 80+ | RSI MTF BULL | ATR TREND | Price: {{close}}")

alertcondition(perfectBearSetup, title="â­ PERFECT BEARISH SETUP - ALL CONDITIONS MET", message="{{ticker}} PERFECT BEAR: Score 80+ | RSI MTF BEAR | ATR TREND | Price: {{close}}")
